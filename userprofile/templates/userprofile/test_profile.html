{% extends "base.html" %}
{% load static %}
{% block content %}
    <div class="container center lighten-3">
        <section class="profile-section">
            <div class="heading-row row row-margin-delete">
                <div class="heading-box right-align col s12">
                    <h2 class="hm ">Hey {{ user.first_name }}!</h2>
                    <p>welcome to the inbox for your references</p>
                </div>
            </div>
            <div class="crumbs-row row">
                <nav class="crumbs-box col s10 m6 right transparent z-depth-0">
                    <div class="nav-wrapper right ">
                          <a  href="#!" class="breadcrumb black-text">Profile</a>
                          <a  href="{% url 'send_request' %}" class="breadcrumb grey-text">Send Request</a>
                    </div>
                </nav>
            </div>
            <div class="req-reference-row row">
                <div class="col s12 profilesque-image grey darken-4">
                    <a class="btn" id="req-reference" href="{% url 'send_request' %}">Ask For Reference</a>
                </div>
            </div>
            <div class="counter-row row row-margin-delete">
                <div class="col s6 counter-box">
                    <div class="card right-align rounded">
                        <div class="card-content">
                            <span class="hs card-title"> Requests </span>
                            <span class="xl3">{{ count_requests }}</span>
                        </div>
                    </div>
                </div>

                <div class=" col s6 counter-box">
                    <div class="card right-align rounded">
                        <div class="card-content">
                            <span class="hs card-title"> References </span>
                            <span class="xl3">{{ count_responses }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <section class="grey rounded">
            <div class="row">
                <div class="col s12 card-panel rounded left-align">
                    <h3 class="hs">Requests awaiting response <i class="material-icons small right">access_time</i></h3>
                    <hr/>

                    <div class="collection">
                        {% for request in requests %}
                            {% if request.status == "PEND" %}
                            <a data-target="{{ request.id }}" class="modal-trigger  collection-item " href="">
                                <div class="row valign-wrapper">
                                    <div class="col s9 content truncate">
                                        <p class="truncate blue-text">
                                            Request to: {{ request.company_name }}<br />
                                            Email recipient: {{ request.to_email }}<br />
                                            Date sent: {{ request.time_sent }} <br />
                                            status: {{ request.get_status_display }}
                                        </p>
                                    </div>
                                    <div class="col s3">
                                        <i class="right material-icons blue-text">delete</i>
                                    </div>  
                                </div>
                            </a>

                            
                            <div id="{{ request.id }}" class="modal">
                                <div class="modal-header">
                                    <div class="modal-image-container">
                                        <img height="300px" width="auto" src="{% static 'img/computer-guy.svg' %}" alt="" />
                                    </div>
                                    <div class="modal-title">
                                        <h3 class="hm">Delete Request</h3>
                                    </div>
                                </div>
                                <div class="modal-info container center-align">
                                    <p> You will no longer be able to get a reference response from {{ request.to_email }} if you proceed</p>                            
                                </div>
                                
                                <div class="modal-content">
                                    
                                    <div class="modal-question container">
                                        <div class="row">
                                            <p class="red-text"> Are you sure you want to permanently delete this request?</p>
                                        </div>
                                            <div class="row light-grey">
                                                <p class="bold">Request Info</p>
                                                <ul>
                                                    <li>You worked at: <br/> <span class="blue-text">{{ request.company_name }}</span></li>
                                                    <li>Your Reference's email: <br/>  <span class="blue-text">{{ request.to_email }}</span></li>
                                                    <li>You worked here between: <br/> <span class="blue-text">{{ request.date_from }}</span> and <span class="blue-text">{{ request.date_to }}</span></li>
                                                    <li>Current Status: <br/> <span class="blue-text">{{ request.get_status_display }} since {{ request.time_sent }}</span></li>
                                                </ul>
                                            </div>
                                           
                                    </div>                                    
                                </div>
                                

                                <div class="modal-footer">
                                   <div class="container">
                                    
                                    <form action="{% url 'delete_request' request.id %}" method="post">
                                        {% csrf_token %} 
                                        <input class="btn-flat right red lighten-1 white-text" value="delete" type="submit" />
                                    </form>
                                  <p  class="modal-close waves-effect  waves-green btn-flat">return</p>
                                 
                                   </div>
                                </div>
                            </div>

                            {% endif %}
                            {% empty %}
                            {% if user.last_login == user.date_joined %}
                            <a class=" collection-item " href="">
                                <div class="row valign-wrapper">
                                    <div class="col s9 content truncate">
                                        <p class="truncate blue-text">
                                            Request to: Some Company Inc. <br />
                                            Email recipient: my.reference@somecompany.com <br />
                                            Date sent: Dec.6, 1991 <br />
                                            When you ask for a reference, your pending request will show up like this. <br />
                                            you can delete a pending request by clicking on it.
                                        </p>
                                    </div>
                                    <div class="col s3">
                                        <i class="right material-icons blue-text">delete</i>
                                    </div>  
                                </div>
                            </a>
                            {% endif %}
                            <div class="col s12 truncate center-align collection-item grey-text"> 
                                <p>No requests in progess. <a class="grey-text" href="{% url 'send_request' %}"><u>Ask for a reference</u></a></p>
                            </div>
                        {% endfor %}
                    </div>
            </div>
            </div>
            
            <div class="row">
                <div class="col s12 card-panel rounded left-align">
                    <h3 class="hs">My References <i class="material-icons small right">list</i></h3>
                    <hr/>
                    
                    
                    <div class="collection">
                        <div class="row collection-item reference-collection grey lighten-3">
                            <div class="col s3 truncate left-align bold">Name</div>
                                    <div class="col s6 truncate center-align bold">Response</div>
                                    <div class="col s3 truncate right-align bold">Response Date</div>
                        </div>
                        {% for response in comp_responses %}
                        <a class="row collection-item reference-collection blue-text" href="">
                                <div class="col s3 truncate left-align"> {{ response.get_full_name }}</div>
                                <div class="col s6 truncate center-align">{{ response.elaborate }}</div>
                                <div class="col s3 truncate right-align">{{ response.time_added }}</div>
                        </a>
                        {% empty %}
                        {% comment %} {{ user.last_login|date:"Y-m-d H:i" }}  {{ current_datetime }} {% endcomment %}
                        {% if user.date_joined|date:"Y-m-d H:i"  == current_datetime %}
                        <a class="example-reference row collection-item reference-collection blue-text" href="">
                            <div class="col s3 truncate left-align"> Elon Musk</div>
                            <div class="col s6 truncate center-align">He kind of knew what he was doing, and he liked twitter wich was nice.</div>
                            <div class="col s3 truncate right-align">Dec. 12, 1991</div>
                         </a>
                        <div class="col s12 truncate center-align collection-item grey-text"> 
                             <p>your references show up here, just like an email, click to read more</p>
                         </div>

                         {% else %}
                         <div class="col s12 truncate center-align collection-item grey-text"> 
                            <p>You don't have any references yet. They will show up here.</p>
                        </div>
                        {% endif %}
                       {% endfor %}
                    </div>
                        
                    </div>
                    
                </div>
            </div>
        </section>

        

{% endblock content %}